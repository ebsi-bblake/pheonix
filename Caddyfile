:8080

# WebSocket proxy must come first
@websocket {
    header Connection *Upgrade*
    header Upgrade websocket
}

handle @websocket {
    reverse_proxy backend:3001
}

# Global CORS preflight handler
@options {
    method OPTIONS
    path_regexp .*
}
handle @options {
    header Access-Control-Allow-Origin "*"
    header Access-Control-Allow-Methods "GET, POST, OPTIONS"
    header Access-Control-Allow-Headers "*"
    respond 204
}

# Static frontend (fallback/default)
handle {
    root * /srv/frontend
    file_server
}
